{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///home/basavaraju/Desktop/tantradotclone/tantradot/src/app/api/contact/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport nodemailer from \"nodemailer\";\n\nconst transporter = nodemailer.createTransport({\n  service: \"gmail\",\n  auth: {\n    user: process.env.MAIL_USERNAME,\n    pass: process.env.MAIL_APP_PASSWORD,\n  },\n});\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const { name, email, phone, location, subject, message } = body;\n\n    // Basic required input validation\n    if (!name || !email || !subject || !message) {\n      return NextResponse.json({ error: \"Name, email, subject and message are required\" }, { status: 400 });\n    }\n\n    if (\n      typeof name !== \"string\" ||\n      typeof email !== \"string\" ||\n      typeof subject !== \"string\" ||\n      typeof message !== \"string\"\n    ) {\n      return NextResponse.json({ error: \"Invalid input format\" }, { status: 400 });\n    }\n\n    // Optional fields validation\n    if (phone && typeof phone !== \"string\") {\n      return NextResponse.json({ error: \"Invalid phone format\" }, { status: 400 });\n    }\n    if (location && typeof location !== \"string\") {\n      return NextResponse.json({ error: \"Invalid location format\" }, { status: 400 });\n    }\n\n    // Email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return NextResponse.json({ error: \"Invalid email format\" }, { status: 400 });\n    }\n\n    // Build email HTML body with optional fields\n    const sanitize = (s: string) => String(s).replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n    const adminHtml = `\n      <h2>New Contact Form Submission</h2>\n      <p><strong>Name:</strong> ${sanitize(name)}</p>\n      <p><strong>Email:</strong> ${sanitize(email)}</p>\n      ${phone ? `<p><strong>Phone:</strong> ${sanitize(phone)}</p>` : \"\"}\n      ${location ? `<p><strong>Location:</strong> ${sanitize(location)}</p>` : \"\"}\n      <p><strong>Subject:</strong> ${sanitize(subject)}</p>\n      <p><strong>Message:</strong></p>\n      <p>${sanitize(message).replace(/\\n/g, \"<br>\")}</p>\n    `;\n\n    // If mail credentials are missing, log and respond (useful for local dev)\n    const mailConfigured = Boolean(process.env.MAIL_USERNAME && process.env.MAIL_APP_PASSWORD);\n\n    if (mailConfigured) {\n      // Send email to admin\n      await transporter.sendMail({\n        from: process.env.MAIL_USERNAME,\n        to: process.env.MAIL_USERNAME,\n        subject: `New Contact Form Submission: ${subject}`,\n        html: adminHtml,\n        replyTo: email,\n      });\n\n      // Send confirmation email to user\n      const userHtml = `\n        <h2>Thank you for contacting TantraDOT</h2>\n        <p>Hi ${sanitize(name)},</p>\n        <p>We have received your message and will get back to you as soon as possible.</p>\n        ${phone ? `<p><strong>Phone provided:</strong> ${sanitize(phone)}</p>` : \"\"}\n        ${location ? `<p><strong>Location provided:</strong> ${sanitize(location)}</p>` : \"\"}\n        <p><strong>Your message:</strong></p>\n        <p>${sanitize(message).replace(/\\n/g, \"<br>\")}</p>\n        <br>\n        <p>Best regards,<br/>TantraDOT Team</p>\n      `;\n\n      await transporter.sendMail({\n        from: process.env.MAIL_USERNAME,\n        to: email,\n        subject: \"We received your message — TantraDOT\",\n        html: userHtml,\n      });\n    } else {\n      console.warn(\"Mail not configured — skipping email send. Submission:\", { name, email, phone, location, subject, message });\n    }\n\n    // Return richer JSON with timestamp and submitted fields (without exposing sensitive internals)\n    const responsePayload = {\n      message: mailConfigured ? \"Email sent successfully\" : \"Received (mail not configured)\",\n      submitted: {\n        name,\n        email,\n        phone: phone || null,\n        location: location || null,\n        subject,\n        message,\n      },\n      receivedAt: new Date().toISOString(),\n    };\n\n    return NextResponse.json(responsePayload, { status: 200 });\n  } catch (error) {\n    console.error(\"Contact form error:\", error);\n    return NextResponse.json(\n      {\n        error: \"Failed to process contact submission\",\n        details: error instanceof Error ? error.message : \"Unknown error\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}